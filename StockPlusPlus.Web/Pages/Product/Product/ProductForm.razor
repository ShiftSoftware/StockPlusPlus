@attribute [Route($"/{nameof(ProductForm)}/{{Key?}}")]

@using StockPlusPlus.Shared.DTOs.Product.Product

@inherits ShiftForm<ProductForm, ProductDTO>

<ShiftEntityForm @bind-Mode="Mode"
                 @bind-Value="TheItem"
                 @ref="FormContainer"
                 Action="Product"
                 Title="Product"
                 TypeAuthAction="StockPlusPlus.Shared.ActionTrees.StockActionTrees.Product"
                 @bind-Key="@Key">

    <MudTextFieldExtended OnlyValidateIfDirty="true"
                          Label="Name"
                          @bind-Value="TheItem.Name"
                          For="@(() => TheItem.Name)" />

    <ShiftDateTimePicker DateLabel="Date"
                         TimeLabel="Time"
                         @bind-DateTimeOffset="TheItem.ReleaseDate" />

    <ShiftAutocompleteWithQuickAdd Label="Brand"
                                   T="ShiftSoftware.ShiftEntity.Model.Dtos.ShiftEntitySelectDTO"
                                   @bind-Value="TheItem.Brand"
                                   ToStringFunc="@(e=> e==null ? null : $"{e.Text}")"
                                   EntitySet="Brand"
                                   TEntitySet="StockPlusPlus.Shared.DTOs.Product.Brand.BrandListDTO"
                                   Where="@(q => x => x.Name!.Contains(q))"
                                   DataValueField="@nameof(StockPlusPlus.Shared.DTOs.Product.Brand.BrandListDTO.ID)"
                                   DataTextField="@nameof(StockPlusPlus.Shared.DTOs.Product.Brand.BrandListDTO.Name)"
                                   TQuickAdd="StockPlusPlus.Shared.DTOs.Product.Brand.BrandDTO"
                                   QuickAddComponentType="typeof(Pages.Product.Brand.BrandForm)"
                                   QuickAddParameterName="@nameof(Pages.Product.Brand.BrandForm.BrandName)" />

    <ShiftAutocompleteWithQuickAdd Label="ProductCategory"
                                   T="ShiftSoftware.ShiftEntity.Model.Dtos.ShiftEntitySelectDTO"
                                   @bind-Value="TheItem.ProductCategory"
                                   ToStringFunc="@(e=> e==null ? null : $"{e.Text}")"
                                   EntitySet="ProductCategory"
                                   TEntitySet="StockPlusPlus.Shared.DTOs.Product.ProductCategory.ProductCategoryListDTO"
                                   Where="@(q => x => x.Name!.Contains(q))"
                                   DataValueField="@nameof(StockPlusPlus.Shared.DTOs.Product.ProductCategory.ProductCategoryListDTO.ID)"
                                   DataTextField="@nameof(StockPlusPlus.Shared.DTOs.Product.ProductCategory.ProductCategoryListDTO.Name)"
                                   TQuickAdd="StockPlusPlus.Shared.DTOs.Product.ProductCategory.ProductCategoryDTO"
                                   QuickAddComponentType="typeof(Pages.Product.ProductCategory.ProductCategoryForm)"
                                   QuickAddParameterName="@nameof(Pages.Product.ProductCategory.ProductCategoryForm.ProductCategoryName)" />


    <ShiftAutocompleteWithQuickAdd Label="Country"
                                   T="ShiftSoftware.ShiftEntity.Model.Dtos.ShiftEntitySelectDTO"
                                   @bind-Value="TheItem.CountryOfOrigin"
                                   ToStringFunc="@(e=> e==null ? null : $"{e.Text}")"
                                   EntitySet="Country"
                                   TEntitySet="StockPlusPlus.Shared.DTOs.CountryDTO"
                                   Where="@(q => x => x.Name!.Contains(q))"
                                   DataValueField="@nameof(StockPlusPlus.Shared.DTOs.CountryDTO.ID)"
                                   DataTextField="@nameof(StockPlusPlus.Shared.DTOs.CountryDTO.Name)"
                                   TQuickAdd="StockPlusPlus.Shared.DTOs.CountryDTO"
                                   QuickAddComponentType="typeof(Pages.Country.CountryForm)"
                                   QuickAddParameterName="@nameof(Pages.Country.CountryForm.Name)" />
</ShiftEntityForm>


@code {
    [Parameter]
    public string? ProductCategoryID { get; set; }

    [Parameter]
    public string? BrandID { get; set; }

    protected override void OnInitialized()
    {
        if (!string.IsNullOrWhiteSpace(ProductCategoryID))
        {
            TheItem.ProductCategory = new ShiftSoftware.ShiftEntity.Model.Dtos.ShiftEntitySelectDTO { Value = ProductCategoryID };
        }

        if (!string.IsNullOrWhiteSpace(BrandID))
        {
            TheItem.Brand = new ShiftSoftware.ShiftEntity.Model.Dtos.ShiftEntitySelectDTO { Value = BrandID };
        }
    }
}